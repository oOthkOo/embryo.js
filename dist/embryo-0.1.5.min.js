var embryo_options={cstrName:"init",cstrArrayName:"_types",forceCstr:!0,nameType:"_type",forceTyping:!0,typeDefault:"Embryo",nameProperties:"properties",nameBlacklist:"_blacklist",deleteBlacklist:!0},embryo_plugins=[],embryo_types=[],debugPlugin=function(e,t,i){console.log("["+e+"] - "+t),console.log("\ttype: ",i._type);i=i.prototype||i;for(var e in i)if(i.hasOwnProperty(e)){var n=i[e],r=typeof n;switch(r){case"function":r=(r=n.toString().replace(/\n/g,"")).replace(/\s+/g," ");break;case"object":r=JSON.stringify(n);break;default:r=n}console.log("\tproperty: ["+e+"]:\t\t["+r+"] -> ("+typeof n+")")}},isTypeExist=function(e,t){for(var i=0;i<e.length;i++){if(e[i].name==t)return!0}return!1},Embryo=function(){for(var e=[],t=0;t<embryo_types.length;t++){this instanceof(r=embryo_types[t]).child&&e.push(r)}for(t=e.length-1;-1<t;t--){var i=(r=e[t]).props;if(i)for(var n in i)i.hasOwnProperty(n)&&void 0===this[n]&&(this[n]=i[n])}for(t=0;t<e.length;t++){var r,o=(r=e[t]).init;o&&o.apply(this,arguments)}};Embryo.version="0.1.5",Embryo.extend=function(e){var t=e[embryo_options.cstrName]||null;if(embryo_options.forceCstr&&!t&&!t)throw Error("No constructor function found.");if(t&&"function"!=typeof t)throw Error("Constructor function invalid.");var i=this,n=function(){return i.apply(this,arguments)};n.extend=i.extend;var r=function(){};r.prototype=this.prototype,n.prototype=new r,embryo_options.forceTyping&&!e[embryo_options.nameType]&&(e[embryo_options.nameType]=embryo_options.typeDefault);for(var o=e[embryo_options.nameType],s=0;s<embryo_plugins.length;s++){var a=embryo_plugins[s],f=a.isDebug()?debugPlugin:null;e=a.exec(e,f,n)}for(var u in e)u==embryo_options.nameBlacklist&&embryo_options.deleteBlacklist||u!=embryo_options.nameProperties&&(u==embryo_options.cstrName&&(isTypeExist(embryo_types,o)||embryo_types.push({name:o,init:e[u]||null,props:e[embryo_options.nameProperties],child:n})),n.prototype[u]=e[u]);return n},Embryo.configure=function(e){for(var t in e)e.hasOwnProperty(t)&&(embryo_options[t]=e[t])},Embryo.use=function(e,t){e.configure(embryo_options),e.setDebug(t),embryo_plugins.push(e)},Embryo.plugins=function(e){for(var t=0;t<embryo_plugins.length;t++){var i=embryo_plugins[t];if(i.name==e)return i}return null},Embryo.configure(),Embryo.Plugin=Embryo.extend({_type:"Plugin",name:"Plugin",options:null,init:function(e){this.setDebug(e)},configure:function(e){for(var t in e)e.hasOwnProperty(t)&&(this.options[t]=e[t])},isBlacklisted:function(e){var t=e._blacklist||!1;if(!t)return!1;for(var i=0;i<t.length;i++){var n=t[i];if(n==this.name||"*"==n)return!0}return!1},isDebug:function(){return this.debug},setDebug:function(e){this.debug=e||!1},getName:function(){return this.name}});var Attribute=Embryo.Plugin.extend({_type:"Attribute",name:"Attribute",options:{getPrefix:"get",setPrefix:"set",camelize:!1},init:function(){},exec:function(e,t,i){if(this.isBlacklisted(e))return t&&console.log("["+this.name+"] - SKIPPED"),e;t&&t(this.name,"BEFORE",e);var n=e[this.options.nameProperties]||{};for(var r in n){if(n.hasOwnProperty(r))if("function"!=typeof n[r]){var o=this.options.camelize?this.camelize(r):r,s=this.options.getPrefix+o;this.defineGetter(e,s,r),o=this.options.camelize?this.camelize(r):r,s=this.options.setPrefix+o,this.defineSetter(e,s,r)}}return t&&t(this.name,"AFTER",e),e},defineGetter:function(e,t,i){e[t]=function(){return this[i]}},defineSetter:function(e,t,i){e[t]=function(e){this[i]=e}},camelize:function(e){return e=(e=e.toLowerCase()).charAt(0).toUpperCase()+e.slice(1)}}),BeforeAfter=Embryo.Plugin.extend({name:"BeforeAfter",options:{beforePrefix:"-",afterPrefix:"+",hiddenPrefix:"_pm_"},init:function(){},exec:function(e,t,i){if(this.isBlacklisted(e))return t&&console.log("["+this.name+"] - SKIPPED"),e;t&&t(this.name,"BEFORE",e);var n={},r=this.options.beforePrefix,o=this.options.afterPrefix;for(var s in e)if(e.hasOwnProperty(s)){var a="",f=null;"function"==typeof e[s]&&(-1<s.indexOf(o)?((f=n[a=s.replace(o,"")])||(f=n[a]={before:!1,after:!1}),f.after=!0):-1<s.indexOf(r)&&((f=n[a=s.replace(r,"")])||(f=n[a]={before:!1,after:!1}),f.before=!0))}for(var u in n)if(n.hasOwnProperty(u)){var h=n[u];this.defineMethod(e,u,h.before,h.after)}return t&&t(this.name,"AFTER",e),e},defineMethod:function(e,t,i,n){if(!e[t])throw new Error("method "+t+" not found.");var r=this.options.hiddenPrefix+t,o=this.options.beforePrefix+t,s=this.options.afterPrefix+t;e[r]=e[t],e[t]=i&&n?function(){this[o].apply(this,arguments),this[r].apply(this,arguments),this[s].apply(this,arguments)}:i?function(){this[o].apply(this,arguments),this[r].apply(this,arguments)}:function(){this[r].apply(this,arguments),this[s].apply(this,arguments)}}}),Surcharge=Embryo.Plugin.extend({name:"Surcharge",options:{suffix:"|",hiddenPrefix:"_pm_"},methods:[],init:function(){},exec:function(e,t,i){if(this.isBlacklisted(e))return t&&console.log("["+this.name+"] - SKIPPED"),e;t&&t(this.name,"BEFORE",e);var n=this.options.suffix;for(var r in this.methods=[],e)if(e.hasOwnProperty(r)&&"function"==typeof e[r]&&-1<r.indexOf(n)){parts=r.split(n);var o=parts[0];o&&(this.isMethodExist(o)||this.methods.push(o))}for(var s=0;s<this.methods.length;s++)this.defineMethod(e,this.methods[s]);return t&&t(this.name,"AFTER",e),e},isMethodExist:function(e){for(var t=0;t<this.methods.length;t++)if(this.methods[t]==e)return!0;return!1},defineMethod:function(e,t){var i=this.options.hiddenPrefix,n=i+t,r=this.options.suffix;e[n]=e[t],e[t]=function(){var e=t+r+arguments.length;if(!this[e]&&!this[e=i+t])throw new Error('method "'+e+'" not defined.');this[e].apply(this,arguments)}}}),Memory=Embryo.Plugin.extend({name:"Memory",options:{nameInstanceArray:"instances",nameNewMethod:"new",nameStatsMethod:"stats",nameDestroyMethod:"destroy"},methods:[],init:function(){},exec:function(e,t,i){return this.isBlacklisted(e)?t&&console.log("["+this.name+"] - SKIPPED"):(t&&t(this.name,"BEFORE",e),e[this.options.nameInstanceArray]=[],e[this.options.nameNewMethod]=function(e,t){var i=t?new e(t):new e;return this.instances.push(i),i},e[this.options.nameStatsMethod]=function(){},e[this.options.nameDestroyMethod]=function(){for(var e=0;e<this.instances.length;e++)delete this.instances[e];this.instances=[]},t&&t(this.name,"AFTER",e)),e}}),Static=Embryo.Plugin.extend({name:"Static",options:{prefix:"$"},init:function(){},exec:function(e,t,i){if(this.isBlacklisted(e))return t&&console.log("["+this.name+"] - SKIPPED"),e;t&&t(this.name,"BEFORE",e);var n=this.options.prefix;for(var r in e)if(e.hasOwnProperty(r)){var o=e[r];if("function"==typeof o&&-1<r.indexOf(n)){parts=r.split(n);var s=parts[1];s&&this.defineStaticMethod(i,s,o)}}return t&&t(this.name,"AFTER",e),e},defineStaticMethod:function(e,t,i){e[t]=function(){return i.apply(this,arguments)}}}),attributePlugin=new Attribute;attributePlugin.configure({getPrefix:"get",setPrefix:"set",camelize:!0});var beforeAfterPlugin=new BeforeAfter;beforeAfterPlugin.configure({beforePrefix:"-",afterPrefix:"+",hiddenPrefix:"_bah_"});var surchargePlugin=new Surcharge;surchargePlugin.configure({suffix:"|",hiddenPrefix:"_pm_"});var memoryPlugin=new Memory;memoryPlugin.configure({nameInstanceArray:"instances",nameNewMethod:"new",nameStatsMethod:"stats",nameDestroyMethod:"destroy"});var staticPlugin=new Static;staticPlugin.configure({prefix:"$"}),Embryo.configure({cstrName:"init",cstrArrayName:"_types",forceCstr:!0,nameType:"_type",forceTyping:!0,typeDefault:"Embryo",nameProperties:"properties",nameBlacklist:"_blacklist",deleteBlacklist:!0}),Embryo.use(attributePlugin,!1),Embryo.use(beforeAfterPlugin,!1),Embryo.use(surchargePlugin,!1),Embryo.use(memoryPlugin,!1),Embryo.use(staticPlugin,!1);
